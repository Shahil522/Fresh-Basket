<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

<!-- Firebase and User Menu Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="/project-folder/firebase-config.js"></script>
<style>
    body { margin-top: 0 !important; padding-top: 0 !important; }
    #user-menu { float: right; margin: 10px; }
    #user-menu .dropdown { position: relative; display: inline-block; }
    #user-menu .dropdown-content { display: none; position: absolute; background: #fff; min-width: 160px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); z-index: 1; }
    #user-menu .dropdown:hover .dropdown-content { display: block; }
    #user-menu .dropdown-content a, #user-menu .dropdown-content button { color: #333; padding: 12px 16px; text-decoration: none; display: block; background: none; border: none; width: 100%; text-align: left; }
    #user-menu .dropdown-content a:hover, #user-menu .dropdown-content button:hover { background: #f1f1f1; }
</style>
<div id="user-menu" style="position:fixed;top:20px;right:30px;z-index:9999;background:#fff;padding:10px 18px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.08);font-size:16px;"></div>
<script>
    function renderUserMenu(user) {
        if (user) {
            document.getElementById('user-menu').innerHTML = `
                <div class="dropdown">
                    <button style="background:none;border:none;cursor:pointer;font-weight:bold;">ðŸ‘¤ ${user.displayName || user.email}</button>
                    <div class="dropdown-content">
                        <a href="/my-account/index.html">Profile</a>
                        <a href="/my-account/orders/index.html">Orders</a>
                        <button id="logout-btn">Logout</button>
                    </div>
                </div>
            `;
            setTimeout(() => {
                const btn = document.getElementById('logout-btn');
                if (btn) btn.onclick = function() {
                    firebase.auth().signOut().then(() => {
                        window.location.href = '/project-folder/index.html';
                    });
                };
            }, 100);
        } else {
            document.getElementById('user-menu').innerHTML = `
                <a href="/sign-in.html">Sign In</a> |
                <a href="/my-account/index.html">Register</a>
            `;
        }
    }
    window.addEventListener('DOMContentLoaded', function() {
        if (window.firebase && firebase.auth) {
            firebase.auth().onAuthStateChanged(renderUserMenu);
        } else {
            setTimeout(() => {
                if (window.firebase && firebase.auth) {
                    firebase.auth().onAuthStateChanged(renderUserMenu);
                }
            }, 1000);
        }
    });
</script>
    <title>My Account</title>
</head>
<body>
    <h1>My Account</h1>
    <p>Name: <span id="userName"></span></p>
    <p>Email: <span id="userEmail"></span></p>
    <p>Phone: <span id="userPhone"></span></p>
    <p>Address: <span id="userAddress"></span></p>
    <button id="logoutBtn">Log Out</button>

    <h2>Order History (Coming Soon)</h2>
    <div id="orders"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBWqcmP4_q0dxTtfkMkPKi6EvS61Ghk42s",
            authDomain: "fresh-basket-e05c0.firebaseapp.com",
            projectId: "fresh-basket-e05c0",
            storageBucket: "fresh-basket-e05c0.firebasestorage.app",
            messagingSenderId: "827276656041",
            appId: "1:827276656041:web:f400f9bcc6b71b39b058b8",
            measurementId: "G-FDWJGSH7FR"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Check if user is logged in
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const docRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('userName').innerText = data.name;
                    document.getElementById('userEmail').innerText = data.email;
                    document.getElementById('userPhone').innerText = data.phone;
                    document.getElementById('userAddress').innerText = data.address;
                } else {
                    alert("No user profile found.");
                }
            } else {
                window.location.href = "sign-in.html";
            }
        });

        // Log out
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await signOut(auth);
            window.location.href = "sign-in.html";
        });
    </script>
</body>
</html>
